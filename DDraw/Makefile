# TODO: Pull the metadata from an external file
DDRAW_NAME ?= SilentPatchDDraw
DDRAW_EXT ?= .dll
DDRAW_FULL_NAME ?= SilentPatch DDraw Component
DDRAW_REVISION_ID ?= 6
DDRAW_BUILD_ID ?= 1
DDRAW_COPYRIGHT ?= 2014-2024

DDRAW_RCFLAGS := -DSILENTPATCH_NAME="$(DDRAW_NAME)" -DSILENTPATCH_EXT="$(DDRAW_EXT)"
DDRAW_RCFLAGS += -DSILENTPATCH_FULL_NAME="$(DDRAW_FULL_NAME)" -DSILENTPATCH_REVISION_ID="$(DDRAW_REVISION_ID)"
DDRAW_RCFLAGS += -DSILENTPATCH_BUILD_ID="$(DDRAW_BUILD_ID)" -DSILENTPATCH_COPYRIGHT="$(DDRAW_COPYRIGHT)"

DDRAW_RES := $(BUILDDIR)/DDraw_res.o

DDRAW_SOURCES := \
	$(ROOTDIR)/SilentPatch/Common_ddraw.cpp \
	$(ROOTDIR)/SilentPatch/Desktop.cpp \
	$(ROOTDIR)/SilentPatch/Utils/Patterns.cpp \
	$(ROOTDIR)/DDraw/dllmain.cpp \
	$(ROOTDIR)/DDraw/DDraw.def

DDRAW_INCLUDES := -I$(ROOTDIR)/SilentPatch

DDraw: utf8_rc $(DDRAW_SOURCES)
	$(WINDRES) $(DDRAW_RCFLAGS) $(DDRAW_INCLUDES) -i $(SP_UTF8) -o $(DDRAW_RES)
	$(CXX) $(SP_CFLAGS) $(DDRAW_RCFLAGS) -o $(BINDIR)/ddraw.dll $(DDRAW_SOURCES) $(DDRAW_RES) $(DDRAW_INCLUDES) $(SP_LDFLAGS)
